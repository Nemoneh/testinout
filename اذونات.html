<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
	<div style="margin-top: 40px; font-size: 20px; font-weight: bold; color: #333;"> ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ°: <span style="color: #007bff;">___________________________________</span></div>
  <div style="margin-top: 40px; font-size: 20px; font-weight: bold; color: #333;"> ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ°: <span style="color: #007bff;">Ø£.Ù…Ø§Ù…ÙˆÙ† Ø¬Ø±Ù† </span></div>
  <div style="margin-top: 40px; font-size: 20px; font-weight: bold; color: #333;"> Ø¨Ø£Ø´Ø±Ø§Ù: <span style="color: #007bff;">Ø£. Ù…Ø­Ù…ÙˆØ¯ Ø²ÙŠØ¯Ø§Ù† </span></div>
  <button onclick="goBack()" style="background-color:#dc3545; color:white; margin-bottom:10px;">Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ</button>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      text-align: center;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 10px;
    }
    th {
      background: #f2f2f2;
    }
    .green {
      background-color: #d4edda;
      color: #155724;
    }
    .red {
      background-color: #f8d7da;
      color: #721c24;
    }
    button {
      padding: 6px 12px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .exit-btn { background: #007bff; color: white; }
    .return-btn { background: #28a745; color: white; }
    .report-btn { background: #ffc107; color: black; }
    select {
      padding: 6px;
      font-size: 16px;
      margin: 15px;
    }
  </style>
</head>
<body>
<h3>Ø§Ù„ØµÙ: <span id="gradeLabel"></span> | Ø§Ù„Ø´Ø¹Ø¨Ø©: <span id="sectionLabel"></span></h3>
<p>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="currentPeriod"></span></p>
<h2>Ø¥Ø¯Ø§Ø±Ø© Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

<label for="classSelect">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©: </label>
<select id="classSelect">
  <option value="A">Ø§Ù„Ø´Ø¹Ø¨Ø© A</option>
  <option value="B">Ø§Ù„Ø´Ø¹Ø¨Ø© B</option>
  <option value="C">Ø§Ù„Ø´Ø¹Ø¨Ø© C</option>
</select>

<button class="report-btn" onclick="showReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

<table id="studentsTable">
  <thead>
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
      <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
      <th>ÙˆÙ‚Øª Ø§Ù„Ø±Ø¬ÙˆØ¹</th>
      <th>ÙØ±Ù‚ Ø§Ù„ÙˆÙ‚Øª</th>
      <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</h3>
<table id="reportTable">
  <thead>
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
      <th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th>
      <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</th>
      <th>Ø§Ù„Ø­ØµØµ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const studentsByClass = {
    "A": ["Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ", "Ù…Ø­Ù…Ø¯ ÙŠÙˆØ³Ù", "Ø³Ø§Ø±Ø© Ø®Ø§Ù„Ø¯", "Ù†ÙˆØ± Ø£Ø­Ù…Ø¯", "Ù„ÙŠÙ„Ù‰ Ø­Ø³Ù†", "Ù…Ø­Ù…ÙˆØ¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ù‡Ø¨Ø© Ø³Ø¹ÙŠØ¯", "Ø¥ÙŠÙ…Ø§Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡", "Ø·Ø§Ø±Ù‚ Ù…Ù†ØµÙˆØ±", "Ù…Ù†Ù‰ Ø¹Ø§Ø¯Ù„"],
    "B": ["ÙŠÙˆØ³Ù Ù…Ø­Ù…Ø¯", "Ø®Ø§Ù„Ø¯ Ø³Ù…ÙŠØ±", "Ù†Ø§Ø¯ÙŠØ© Ø­Ø³ÙŠÙ†", "Ø³Ù„ÙˆÙ‰ Ø¬Ù…Ø§Ù„", "Ø£Ø­Ù…Ø¯ ÙØ¤Ø§Ø¯", "Ø³Ø¹ÙŠØ¯ Ù…Ø­Ù…ÙˆØ¯", "Ù…Ø±ÙˆØ§Ù† Ø¹Ù…Ø±", "Ù‡Ù†Ø§Ø¡ ÙŠÙˆØ³Ù", "ÙØ§Ø·Ù…Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†", "Ø±Ø§Ù…ÙŠ Ø·Ø§Ø±Ù‚"],
    "C": ["Ø­Ø³Ø§Ù… Ø¹Ù„ÙŠ", "Ø£Ù…Ø§Ù†ÙŠ Ø­Ø³Ù†", "Ù…Ø­Ù…ÙˆØ¯ Ù…Ø±Ø§Ø¯", "Ø£Ø­Ù…Ø¯ Ø³Ù…ÙŠØ±", "Ø²ÙŠÙ†Ø¨ Ù…Ø­Ù…Ø¯", "Ø³Ø§Ø±Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ²", "Ø£Ø´Ø±Ù Ø¹Ù„ÙŠ", "Ù‡Ø§Ø¬Ø± ÙŠÙˆØ³Ù", "Ù…Ø±ÙˆÙ‰ Ø­Ø³ÙŠÙ†", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ø§Ù„Ø¯"]
  };

  let reportData = {};

  function formatDateTime(date) {
    const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
    let dayName = days[date.getDay()];
    let year = date.getFullYear();
    let month = (date.getMonth()+1).toString().padStart(2,"0");
    let day = date.getDate().toString().padStart(2,"0");
    let hours = date.getHours().toString().padStart(2,"0");
    let minutes = date.getMinutes().toString().padStart(2,"0");
    let seconds = date.getSeconds().toString().padStart(2,"0");
    return `${dayName} ${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
  }

  function getPeriodNumber(date) {
    const startHour = 7;
    const startMinute = 30;
    const startTime = new Date(date.getFullYear(), date.getMonth(), date.getDate(), startHour, startMinute);
    const diffMs = date - startTime;
    const diffMinutes = Math.floor(diffMs / 60000);
    const period = Math.floor(diffMinutes / 45) + 1;
    return period > 0 ? `Ø§Ù„Ø­ØµØ© ${period}` : "Ø®Ø§Ø±Ø¬ ÙˆÙ‚Øª Ø§Ù„Ø­ØµØµ";
  }


  function setExit(button) {
  let row = button.closest("tr");
  let now = new Date();
  let name = row.querySelector("td").innerText;
  let period = getPeriodNumber(now);
  let grade = localStorage.getItem("selectedGrade");
  let section = localStorage.getItem("selectedSection");

  row.querySelector(".exit-time").innerText = formatDateTime(now);
  row.querySelector(".return-time").innerText = "";
  row.querySelector(".diff-time").innerText = "";
  row.querySelector(".diff-time").className = "diff-time"; 
  row.querySelector(".period-number").innerText = period;
  row.dataset.exit = now.getTime();
  button.disabled = true;

  // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¤Ù‚Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
  if (!reportData[name]) {
    reportData[name] = { count: 0, periods: [], class: section };
  }
  reportData[name].count += 1;
  reportData[name].periods.push(period);

  // Ø­ÙØ¸ ÙÙŠ LocalStorage Ù„ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
  const storageKey = `${grade}_${section}_report`;
  let fullReport = JSON.parse(localStorage.getItem(storageKey) || "{}");

  if (!fullReport[name]) {
    fullReport[name] = { count: 0, periods: [] };
  }
  fullReport[name].count += 1;
  fullReport[name].periods.push(period);

  localStorage.setItem(storageKey, JSON.stringify(fullReport));
}

  function setReturn(button) {
    let row = button.closest("tr");
    let now = new Date();
    row.querySelector(".return-time").innerText = formatDateTime(now);
    row.querySelector(".period-number").innerText = getPeriodNumber(now);

    let exitTime = row.dataset.exit;
    if (exitTime) {
      let diffMs = now.getTime() - exitTime;
      let diffHours = Math.floor(diffMs / 3600000);
      let diffMinutes = Math.floor((diffMs % 3600000) / 60000);

      row.querySelector(".diff-time").innerText = `${diffHours} Ø³Ø§Ø¹Ø© Ùˆ ${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`;

      if (diffHours > 0 || diffMinutes > 5) {
        row.querySelector(".diff-time").className = "diff-time red";
      } else {
        row.querySelector(".diff-time").className = "diff-time green";
      }
    }
    button.disabled = true;
  }

   function loadStudents() {
    const grade = localStorage.getItem("selectedGrade");
    const section = localStorage.getItem("selectedSection");
    const key = `${grade}_${section}`;
    const students = JSON.parse(localStorage.getItem(key)) || [];

    const tbody = document.querySelector("#studentsTable tbody");
    tbody.innerHTML = "";

    students.forEach(name => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td class="exit-time"></td>
        <td class="return-time"></td>
        <td class="diff-time"></td>
        <td class="period-number"></td>
        <td>
          <button class="exit-btn" onclick="setExit(this)">Ø®Ø±ÙˆØ¬</button>
          <button class="return-btn" onclick="setReturn(this)">Ø±Ø¬ÙˆØ¹</button>
        </td>
      `;
      tbody.appendChild(tr);
     });
    }
	


  function showReport() {
     
    const tbody = document.querySelector("#reportTable tbody");
    tbody.innerHTML = "";

    for (let name in reportData) {
      let data = reportData[name];
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td>${data.class}</td>
        <td>${data.count}</td>
        <td>${data.periods.join("ØŒ ")}</td>
      `;
      tbody.appendChild(tr);
    }
	
  }

  document.getElementById("classSelect").addEventListener("change", loadStudents);
  window.onload = loadStudents;
  
  function goBack() {
  window.location.href = "Ø§Ø®ØªÙŠØ§Ø±.html";
}
  // Ø£Ø¶Ù Ù‡Ø°Ø§ Ø¯Ø§Ø®Ù„ <script>
document.getElementById("gradeLabel").innerText = localStorage.getItem("selectedGrade") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
document.getElementById("sectionLabel").innerText = localStorage.getItem("selectedSection") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";

function updateCurrentPeriod() {
  const now = new Date();
  const startTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 7, 30);
  const diffMinutes = Math.floor((now - startTime) / 60000);
  const period = Math.floor(diffMinutes / 45) + 1;
  document.getElementById("currentPeriod").innerText = period > 0 ? `Ø§Ù„Ø­ØµØ© ${period}` : "Ø®Ø§Ø±Ø¬ ÙˆÙ‚Øª Ø§Ù„Ø­ØµØµ";
}
setInterval(updateCurrentPeriod, 60000);
window.onload = () => {
  updateCurrentPeriod();
  loadStudents(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
};
</script>

</body>
</html>


